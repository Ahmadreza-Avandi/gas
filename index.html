<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دستگاه پایش گاز</title>
    <link rel="icon" href="gas-icon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #0a0a0a;
            color: #e5e7eb;
            overflow-x: hidden;
        }
        
        .particle {
            position: absolute;
            background-color: rgba(59, 130, 246, 0.5);
            border-radius: 50%;
            pointer-events: none;
        }
        
        .glow {
            box-shadow: 0 0 10px currentColor;
        }
        
        .glow-blue {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7), 0 0 30px rgba(59, 130, 246, 0.4), 0 0 45px rgba(59, 130, 246, 0.2);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.7), 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .glow-orange {
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.7);
        }
        
        .glow-purple {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.7);
        }
        
        .glow-red {
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.7);
        }
        
        .glow-green {
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.7);
        }
        
        .circular-progress {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .circular-progress::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid #1f2937;
        }
        
        .progress-value {
            position: relative;
            font-size: 24px;
            font-weight: bold;
        }
        
        .vertical-gauge {
            width: 40px;
            height: 120px;
            background: linear-gradient(to top, #3b82f6, #ef4444);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .gauge-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #f59e0b, #ef4444);
            transition: height 0.5s ease;
        }
        
        .horizontal-bar {
            width: 100%;
            height: 20px;
            background-color: #1f2937;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(to right, #8b5cf6, #d946ef);
            transition: width 0.5s ease;
        }
        
        .speedometer {
            width: 120px;
            height: 60px;
            position: relative;
            border-top-left-radius: 60px;
            border-top-right-radius: 60px;
            overflow: hidden;
        }
        
        .speedometer::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0.5turn at 50% 100%, #3b82f6 0%, #93c5fd 50%, #ffffff 100%);
            border-top-left-radius: 60px;
            border-top-right-radius: 60px;
        }
        
        .speedometer::after {
            content: "";
            position: absolute;
            width: 80%;
            height: 80%;
            background-color: #0a0a0a;
            border-top-left-radius: 48px;
            border-top-right-radius: 48px;
            top: 20%;
            left: 10%;
        }
        
        .needle {
            position: absolute;
            width: 2px;
            height: 50%;
            background-color: #ffffff;
            bottom: 0;
            left: 50%;
            transform-origin: bottom;
            transform: rotate(0deg);
            transition: transform 0.5s ease;
        }
        
        .bubble {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
        }
        
        .bubble::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--bubble-color, rgba(16, 185, 129, 0.8)), rgba(16, 185, 129, 0.4));
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
            100% {
                transform: scale(1);
                opacity: 0.7;
            }
        }
        
        .camera-feed {
            width: 320px;
            height: 180px;
            background-color: #111827;
            border: 2px solid #1f2937;
            transition: all 0.3s ease;
        }
        
        .camera-active {
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }
        
        .camera-inactive {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }
        
        .warning-flash {
            animation: flash 1s infinite;
        }
        
        @keyframes flash {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #111827;
            border-radius: 10px;
            width: 80%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            border: 1px solid #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .table-container {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .table-container::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background-color: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background-color: #1f2937;
        }
        
        @media (max-width: 768px) {
            .gas-display-grid {
                grid-template-columns: 1fr !important;
            }
            .camera-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .camera-grid {
                grid-template-columns: 1fr 1fr !important;
            }
        }
    </style>
</head>

<body class="relative overflow-x-hidden">
    <!-- Particles Background -->
    <div id="particles"></div>

    <!-- Header -->
    <header class="bg-black py-4 px-6 border-b border-gray-800 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-900/20 to-purple-900/20"></div>
        <div class="container mx-auto flex justify-between items-center relative z-10">
            <div class="flex items-center">
                <div class="ml-4 w-12 h-12">
                    <object data="gas-icon.svg" type="image/svg+xml" class="w-full h-full"></object>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold text-blue-400 tracking-wider">دستگاه پایش گاز</h1>
                    <div class="h-1 w-32 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full my-2"></div>
                    <div class="flex space-x-4 space-x-reverse mt-2">
                        <div id="datetime" class="text-sm text-gray-300"></div>
                        <div id="system-status" class="text-sm font-medium px-2 py-1 rounded-full bg-green-900 text-green-300">
                            <i class="fas fa-circle text-xs mr-1"></i> فعال
                        </div>
                    </div>
                </div>
                <div class="flex space-x-3 space-x-reverse">
                    <button id="show-data-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                    نمایش داده‌های ثبت‌شده
                </button>
                    <button id="reset-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                    تنظیم مجدد
                </button>
                </div>
            </div>
    </header>

    <!-- Warning Alert -->
    <div id="warning-alert" class="hidden bg-red-900 text-white py-2 px-4 text-center warning-flash">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <span id="warning-text">هشدار! سطح گاز خطرناک است</span>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Gas Parameters Display -->
        <section class="mb-8">
            <h2 class="text-xl font-bold mb-6 text-center text-blue-300">پارامترهای گازی</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 gas-display-grid">
                <!-- CO2 Display -->
                <div class="bg-gray-900 rounded-xl p-6 border border-blue-500 glow-blue">
                    <h3 class="text-lg font-bold text-center text-blue-300 mb-4">دی‌اکسید کربن (CO₂)</h3>
                    <div class="flex flex-col items-center">
                        <div class="circular-progress mb-2">
                            <div class="progress-value text-blue-300" id="co2-value">450</div>
                        </div>
                        <div class="text-sm text-gray-400">ppm</div>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <span>محدوده امن: &lt;4000 ppm</span> |
                        <span class="text-yellow-400">هشدار: 4000-5000 ppm</span> |
                        <span class="text-red-400">خطرناک: &gt;5000 ppm</span>
                    </div>
                </div>

                <!-- CH4 Display -->
                <div class="bg-gray-900 rounded-xl p-6 border border-orange-500 glow-orange">
                    <h3 class="text-lg font-bold text-center text-orange-300 mb-4">متان (CH₄)</h3>
                    <div class="flex flex-col items-center">
                        <div class="text-2xl font-bold text-orange-300 mb-2" id="ch4-value">120</div>
                        <div class="vertical-gauge">
                            <div class="gauge-fill" id="ch4-gauge" style="height: 30%"></div>
                        </div>
                        <div class="text-sm text-gray-400 mt-2">ppm</div>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <span>محدوده امن: &lt;4500 ppm</span> |
                        <span class="text-yellow-400">هشدار: 4500-5000 ppm</span> |
                        <span class="text-red-400">خطرناک: &gt;5000 ppm</span> |
                        <span class="text-red-600">قطع سیستم: &gt;5500 ppm</span>
                    </div>
                </div>

                <!-- C2H6 Display -->
                <div class="bg-gray-900 rounded-xl p-6 border border-purple-500 glow-purple">
                    <h3 class="text-lg font-bold text-center text-purple-300 mb-4">اتان (C₂H₆)</h3>
                    <div class="flex flex-col items-center">
                        <div class="text-2xl font-bold text-purple-300 mb-2" id="c2h6-value">80</div>
                        <div class="w-full">
                            <div class="horizontal-bar">
                                <div class="bar-fill" id="c2h6-bar" style="width: 20%"></div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400 mt-2">ppm</div>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <span>محدوده امن: &lt;3000 ppm</span> |
                        <span class="text-yellow-400">هشدار: 3000-3500 ppm</span> |
                        <span class="text-red-400">خطرناک: &gt;3500 ppm</span> |
                        <span class="text-red-600">قطع سیستم: &gt;4000 ppm</span>
                    </div>
                </div>

                <!-- O2 Display -->
                <div class="bg-gray-900 rounded-xl p-6 border border-blue-300 glow-blue">
                    <h3 class="text-lg font-bold text-center text-blue-200 mb-4">اکسیژن (O₂)</h3>
                    <div class="flex flex-col items-center">
                        <div class="speedometer mb-2">
                            <div class="needle" id="o2-needle" style="transform: rotate(0.25turn);"></div>
                        </div>
                        <div class="text-xl font-bold text-blue-200" id="o2-value">20.9</div>
                        <div class="text-sm text-gray-400">%</div>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <span>محدوده امن: 19–23%</span> |
                        <span class="text-red-400">خطرناک: &lt;19%</span>
                    </div>
                </div>

                <!-- H2 Display -->
                <div class="bg-gray-900 rounded-xl p-6 border border-green-500 glow-green">
                    <h3 class="text-lg font-bold text-center text-green-300 mb-4">هیدروژن (H₂)</h3>
                    <div class="flex flex-col items-center">
                        <div class="bubble" id="h2-bubble">
                            <div class="text-lg font-bold text-white z-10" id="h2-value">50</div>
                        </div>
                        <div class="text-sm text-gray-400 mt-2">ppm</div>
                    </div>
                    <div class="mt-4 text-xs text-gray-400">
                        <span>محدوده امن: &lt;3000 ppm</span> |
                        <span class="text-yellow-400">هشدار: 3000-4000 ppm</span> |
                        <span class="text-red-400">خطرناک: &gt;4000 ppm</span> |
                        <span class="text-orange-400">هشدار بالا: &gt;10000 ppm</span> |
                        <span class="text-red-600">قطع سیستم: &gt;20000 ppm</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chart Section -->
        <section class="mb-8">
            <h2 class="text-xl font-bold mb-4 text-center text-blue-300">نمودار تغییرات گازها</h2>
            <div class="bg-gray-900 rounded-xl p-4 border border-gray-700">
                <canvas id="gasChart" height="300"></canvas>
            </div>
        </section>

        <!-- Camera Feeds -->
        <section>
            <h2 class="text-xl font-bold mb-4 text-center text-blue-300">دوربین‌های نظارتی</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 camera-grid">
                <div class="bg-gray-900 rounded-xl p-4 border border-gray-700 hover:border-blue-500 transition-all duration-300">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <div class="camera-status w-3 h-3 rounded-full bg-green-500 mr-2 transition-colors duration-300"></div>
                            <h3 class="font-bold text-blue-300">دوربین ۱</h3>
                        </div>
                        <button class="camera-toggle bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-300" data-camera="1">
                            خاموش کردن
                        </button>
                    </div>
                    <div class="camera-feed camera-active flex items-center justify-center" id="camera-1">
                        <i class="fas fa-video text-gray-500 text-3xl"></i>
                    </div>
                </div>

                <div class="bg-gray-900 rounded-xl p-4 border border-gray-700">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <div class="camera-status w-3 h-3 rounded-full bg-green-500 mr-2"></div>
                            <h3 class="font-bold text-blue-300">دوربین ۲</h3>
                        </div>
                        <button class="camera-toggle bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition" data-camera="2">
                            روشن/خاموش
                        </button>
                    </div>
                    <div class="camera-feed camera-active flex items-center justify-center" id="camera-2">
                        <i class="fas fa-video text-gray-500 text-3xl"></i>
                    </div>
                </div>

                <div class="bg-gray-900 rounded-xl p-4 border border-gray-700 hover:border-blue-500 transition-all duration-300">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <div class="camera-status w-3 h-3 rounded-full bg-green-500 mr-2 transition-colors duration-300"></div>
                            <h3 class="font-bold text-blue-300">دوربین ۳</h3>
                        </div>
                        <button class="camera-toggle bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-300" data-camera="3">
                            خاموش کردن
                        </button>
                    </div>
                    <div class="camera-feed camera-active flex items-center justify-center" id="camera-3">
                        <i class="fas fa-video text-gray-500 text-3xl"></i>
                    </div>
                </div>

                <div class="bg-gray-900 rounded-xl p-4 border border-gray-700 hover:border-blue-500 transition-all duration-300">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center">
                            <div class="camera-status w-3 h-3 rounded-full bg-green-500 mr-2 transition-colors duration-300"></div>
                            <h3 class="font-bold text-blue-300">دوربین ۴</h3>
                        </div>
                        <button class="camera-toggle bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-300" data-camera="4">
                            خاموش کردن
                        </button>
                    </div>
                    <div class="camera-feed camera-active flex items-center justify-center" id="camera-4">
                        <i class="fas fa-video text-gray-500 text-3xl"></i>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Data Log Modal -->
    <div id="data-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-blue-300">داده‌های ثبت‌شده</h2>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead class="bg-gray-800">
                        <tr>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">زمان</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">CO₂ (ppm)</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">CH₄ (ppm)</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">C₂H₆ (ppm)</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">O₂ (%)</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">H₂ (ppm)</th>
                        </tr>
                    </thead>
                    <tbody class="bg-gray-900 divide-y divide-gray-800" id="data-table-body">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Database simulation
        const database = {
            logs: [],
            addLog: function(timestamp, co2, ch4, c2h6, o2, h2) {
                this.logs.push({
                    timestamp,
                    co2,
                    ch4,
                    c2h6,
                    o2,
                    h2
                });
                if (this.logs.length > 1440) {
                    this.logs.shift(); // Keep only 24 hours of data (1 minute intervals)
                }
            },
            clear: function() {
                this.logs = [];
            },
            getLast100: function() {
                return this.logs.slice(-100).reverse();
            }
        };

        // Initialize particles
        function initParticles() {
            const container = document.getElementById('particles');
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');

                // Random size between 1 and 3px
                const size = Math.random() * 2 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;

                // Random color from a set of neon colors
                const colors = ['rgba(59, 130, 246, 0.5)', 'rgba(245, 158, 11, 0.5)', 'rgba(168, 85, 247, 0.5)', 'rgba(239, 68, 68, 0.5)', 'rgba(16, 185, 129, 0.5)'];
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                // Random animation
                const duration = Math.random() * 20 + 10;
                particle.style.animation = `float ${duration}s linear infinite`;

                // Add to container
                container.appendChild(particle);
            }

            // Add floating animation
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes float {
                    0% { transform: translate(0, 0); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('fa-IR', options);
        }

        // Generate random gas data
        function generateRandomGasData() {
            // تولید داده‌های تصادفی با احتمال کمتر برای مقادیر بحرانی
            const generateValue = (min, max, criticalThreshold, criticalProbability = 0.1) => {
                // احتمال کم برای تولید مقادیر بحرانی
                if (Math.random() < criticalProbability) {
                    return Math.floor(Math.random() * (max - criticalThreshold) + criticalThreshold);
                } else {
                    return Math.floor(Math.random() * (criticalThreshold - min) + min);
                }
            };

            return {
                co2: generateValue(400, 6000, gasThresholds.co2.warning), // 400-6000 ppm
                ch4: generateValue(0, 6000, gasThresholds.ch4.warning), // 0-6000 ppm
                c2h6: generateValue(0, 5000, gasThresholds.c2h6.warning), // 0-5000 ppm
                o2: (Math.random() * 10 + 15).toFixed(1), // 15-25%
                h2: generateValue(0, 25000, gasThresholds.h2.warning) // 0-25000 ppm
            };
        }

        // Update gas displays
        function updateGasDisplays(data) {
            // CO2 - Circular progress
            document.getElementById('co2-value').textContent = data.co2;
            const co2Max = 5000; // مقدار حداکثر برای نمایش
            const co2Percentage = Math.min(100, (data.co2 / co2Max) * 100);
            const co2Circle = document.querySelector('.circular-progress');

            // رنگ‌بندی بر اساس محدوده‌های خطر
            let co2Color = '#10b981'; // سبز برای حالت عادی
            if (data.co2 >= gasThresholds.co2.critical) {
                co2Color = '#ef4444'; // قرمز برای حالت بحرانی
            } else if (data.co2 >= gasThresholds.co2.warning) {
                co2Color = '#f59e0b'; // نارنجی برای هشدار
            }

            co2Circle.style.background = `conic-gradient(from 0.25turn, ${co2Color} 0%, ${co2Color} ${co2Percentage}%, #1f2937 ${co2Percentage}%)`;
            document.getElementById('co2-value').style.color = co2Color;

            // CH4 - Vertical gauge
            document.getElementById('ch4-value').textContent = data.ch4;
            const ch4Max = 5500; // مقدار حداکثر برای نمایش
            const ch4Percentage = Math.min(100, (data.ch4 / ch4Max) * 100);
            const ch4Gauge = document.getElementById('ch4-gauge');
            ch4Gauge.style.height = `${ch4Percentage}%`;

            // رنگ‌بندی بر اساس محدوده‌های خطر
            let ch4Color = '#10b981'; // سبز برای حالت عادی
            if (data.ch4 >= gasThresholds.ch4.shutdown) {
                ch4Color = '#7f1d1d'; // قرمز تیره برای قطع سیستم
                ch4Gauge.style.background = 'linear-gradient(to top, #7f1d1d, #ef4444)';
            } else if (data.ch4 >= gasThresholds.ch4.critical) {
                ch4Color = '#ef4444'; // قرمز برای حالت بحرانی
                ch4Gauge.style.background = 'linear-gradient(to top, #ef4444, #ef4444)';
            } else if (data.ch4 >= gasThresholds.ch4.warning) {
                ch4Color = '#f59e0b'; // نارنجی برای هشدار
                ch4Gauge.style.background = 'linear-gradient(to top, #f59e0b, #ef4444)';
            } else {
                ch4Gauge.style.background = 'linear-gradient(to top, #10b981, #f59e0b)';
            }
            document.getElementById('ch4-value').style.color = ch4Color;

            // C2H6 - Horizontal bar
            document.getElementById('c2h6-value').textContent = data.c2h6;
            const c2h6Max = 4000; // مقدار حداکثر برای نمایش
            const c2h6Percentage = Math.min(100, (data.c2h6 / c2h6Max) * 100);
            const c2h6Bar = document.getElementById('c2h6-bar');
            c2h6Bar.style.width = `${c2h6Percentage}%`;

            // رنگ‌بندی بر اساس محدوده‌های خطر
            let c2h6Color = '#10b981'; // سبز برای حالت عادی
            if (data.c2h6 >= gasThresholds.c2h6.shutdown) {
                c2h6Color = '#7f1d1d'; // قرمز تیره برای قطع سیستم
                c2h6Bar.style.background = 'linear-gradient(to right, #7f1d1d, #ef4444)';
            } else if (data.c2h6 >= gasThresholds.c2h6.critical) {
                c2h6Color = '#ef4444'; // قرمز برای حالت بحرانی
                c2h6Bar.style.background = 'linear-gradient(to right, #ef4444, #ef4444)';
            } else if (data.c2h6 >= gasThresholds.c2h6.warning) {
                c2h6Color = '#f59e0b'; // نارنجی برای هشدار
                c2h6Bar.style.background = 'linear-gradient(to right, #f59e0b, #ef4444)';
            } else {
                c2h6Bar.style.background = 'linear-gradient(to right, #8b5cf6, #d946ef)';
            }
            document.getElementById('c2h6-value').style.color = c2h6Color;

            // O2 - Speedometer
            document.getElementById('o2-value').textContent = data.o2;
            const o2Percentage = (data.o2 - 15) / 10; // 15-25% range
            const o2Rotation = 0.25 + (o2Percentage * 0.5); // 0.25-0.75 turn
            document.getElementById('o2-needle').style.transform = `rotate(${o2Rotation}turn)`;

            // رنگ‌بندی بر اساس محدوده‌های خطر
            let o2Color = '#3b82f6'; // آبی برای حالت عادی
            if (data.o2 < 19) {
                o2Color = '#ef4444'; // قرمز برای حالت خطرناک
            }
            document.getElementById('o2-value').style.color = o2Color;

            // H2 - Bubble
            document.getElementById('h2-value').textContent = data.h2;
            const h2Max = 20000; // مقدار حداکثر برای نمایش
            const h2Percentage = Math.min(100, (data.h2 / h2Max) * 100);
            const bubble = document.getElementById('h2-bubble');
            bubble.style.width = `${80 + (h2Percentage * 0.5)}px`;
            bubble.style.height = `${80 + (h2Percentage * 0.5)}px`;

            // رنگ‌بندی بر اساس محدوده‌های خطر
            let h2Color = '#10b981'; // سبز برای حالت عادی
            if (data.h2 >= gasThresholds.h2.shutdown) {
                h2Color = '#7f1d1d'; // قرمز تیره برای قطع سیستم
                bubble.style.setProperty('--bubble-color', 'rgba(127, 29, 29, 0.8)');
            } else if (data.h2 >= gasThresholds.h2.warning_high) {
                h2Color = '#ef4444'; // قرمز برای هشدار بالا
                bubble.style.setProperty('--bubble-color', 'rgba(239, 68, 68, 0.8)');
            } else if (data.h2 >= gasThresholds.h2.critical) {
                h2Color = '#b91c1c'; // قرمز تیره‌تر برای حالت بحرانی
                bubble.style.setProperty('--bubble-color', 'rgba(185, 28, 28, 0.8)');
            } else if (data.h2 >= gasThresholds.h2.warning) {
                h2Color = '#f59e0b'; // نارنجی برای هشدار
                bubble.style.setProperty('--bubble-color', 'rgba(245, 158, 11, 0.8)');
            } else {
                bubble.style.setProperty('--bubble-color', 'rgba(16, 185, 129, 0.8)');
            }
            document.getElementById('h2-value').style.color = h2Color;

            // Check for warnings
            checkWarnings(data);
        }

        // تعریف محدوده‌های خطر برای گازها
        const gasThresholds = {
            co2: {
                warning: 4000, // هشدار در 4000 ppm
                critical: 5000, // بحرانی در 5000 ppm
            },
            ch4: {
                warning: 4500, // هشدار در 4500 ppm
                critical: 5000, // بحرانی در 5000 ppm
                shutdown: 5500, // قطع سیستم در 5500 ppm
            },
            c2h6: {
                warning: 3000, // هشدار در 3000 ppm
                critical: 3500, // بحرانی در 3500 ppm
                shutdown: 4000, // قطع سیستم در 4000 ppm
            },
            h2: {
                warning: 3000, // هشدار در 3000 ppm
                critical: 4000, // بحرانی در 4000 ppm
                warning_high: 10000, // هشدار در 10000 ppm
                shutdown: 20000, // قطع سیستم در 20000 ppm
            }
        };

        // وضعیت سیستم
        let systemActive = true;

        // Check for dangerous gas levels
        function checkWarnings(data) {
            const warnings = [];
            const criticalWarnings = [];
            const shutdownReasons = [];

            // بررسی سطوح خطرناک گازها
            if (data.co2 >= gasThresholds.co2.warning) {
                warnings.push(`CO₂: ${data.co2} ppm`);
                if (data.co2 >= gasThresholds.co2.critical) {
                    criticalWarnings.push(`CO₂: ${data.co2} ppm`);
                }
            }

            if (data.ch4 >= gasThresholds.ch4.warning) {
                warnings.push(`CH₄: ${data.ch4} ppm`);
                if (data.ch4 >= gasThresholds.ch4.critical) {
                    criticalWarnings.push(`CH₄: ${data.ch4} ppm`);
                }
                if (data.ch4 >= gasThresholds.ch4.shutdown) {
                    shutdownReasons.push(`CH₄: ${data.ch4} ppm`);
                }
            }

            if (data.c2h6 >= gasThresholds.c2h6.warning) {
                warnings.push(`C₂H₆: ${data.c2h6} ppm`);
                if (data.c2h6 >= gasThresholds.c2h6.critical) {
                    criticalWarnings.push(`C₂H₆: ${data.c2h6} ppm`);
                }
                if (data.c2h6 >= gasThresholds.c2h6.shutdown) {
                    shutdownReasons.push(`C₂H₆: ${data.c2h6} ppm`);
                }
            }

            if (data.o2 < 19) {
                warnings.push(`O₂: ${data.o2}%`);
                criticalWarnings.push(`O₂: ${data.o2}%`);
            }

            if (data.h2 >= gasThresholds.h2.warning) {
                warnings.push(`H₂: ${data.h2} ppm`);
                if (data.h2 >= gasThresholds.h2.critical) {
                    criticalWarnings.push(`H₂: ${data.h2} ppm`);
                }
                if (data.h2 >= gasThresholds.h2.warning_high) {
                    warnings.push(`H₂: ${data.h2} ppm (سطح بالا)`);
                }
                if (data.h2 >= gasThresholds.h2.shutdown) {
                    shutdownReasons.push(`H₂: ${data.h2} ppm`);
                }
            }

            const warningAlert = document.getElementById('warning-alert');
            const warningText = document.getElementById('warning-text');
            const systemStatusElement = document.getElementById('system-status');

            // نمایش هشدارها
            if (warnings.length > 0) {
                warningText.textContent = `هشدار! ${warnings.join('، ')}`;
                warningAlert.classList.remove('hidden');
                warningAlert.classList.add('warning-flash');

                // تغییر رنگ هشدار بر اساس شدت خطر
                if (criticalWarnings.length > 0) {
                    warningAlert.style.backgroundColor = '#b91c1c'; // قرمز تیره‌تر برای هشدارهای بحرانی
                } else {
                    warningAlert.style.backgroundColor = '#7f1d1d'; // قرمز تیره برای هشدارهای عادی
                }
            } else {
                warningAlert.classList.add('hidden');
                warningAlert.classList.remove('warning-flash');
            }

            // بررسی وضعیت بحرانی و قطع سیستم
            if (shutdownReasons.length > 0 && systemActive) {
                shutdownSystem(shutdownReasons);
            }
        }

        // قطع سیستم در صورت رسیدن به مقادیر بحرانی
        function shutdownSystem(criticalWarnings) {
            systemActive = false;

            // تغییر وضعیت سیستم به غیرفعال
            const systemStatusElement = document.getElementById('system-status');
            systemStatusElement.classList.remove('bg-green-900', 'text-green-300');
            systemStatusElement.classList.add('bg-red-900', 'text-red-300');
            systemStatusElement.innerHTML = '<i class="fas fa-circle text-xs mr-1"></i> غیرفعال - قطع اضطراری';

            // نمایش هشدار قطع سیستم
            const warningAlert = document.getElementById('warning-alert');
            const warningText = document.getElementById('warning-text');
            warningText.textContent = `قطع اضطراری سیستم! مقادیر بحرانی: ${criticalWarnings.join('، ')}`;
            warningAlert.classList.remove('hidden');
            warningAlert.classList.add('warning-flash');
            warningAlert.style.backgroundColor = '#7f1d1d'; // رنگ قرمز تیره‌تر

            // غیرفعال کردن دوربین‌ها
            document.querySelectorAll('.camera-feed').forEach(camera => {
                camera.classList.remove('camera-active');
                camera.classList.add('camera-inactive');
            });

            document.querySelectorAll('.camera-status').forEach(status => {
                status.classList.remove('bg-green-500');
                status.classList.add('bg-red-500');
            });

            document.querySelectorAll('.camera-toggle').forEach(button => {
                button.disabled = true;
                button.classList.add('opacity-50');
                button.textContent = 'غیرفعال';
            });

            // نمایش پیام هشدار
            alert('سیستم به دلیل رسیدن به مقادیر بحرانی گاز قطع شد! لطفاً محیط را تخلیه کنید.');
        }

        // Initialize chart
        let gasChart;

        function initChart() {
            const ctx = document.getElementById('gasChart').getContext('2d');

            // Generate initial data for the last hour (12 points, 5 minute intervals)
            const labels = [];
            const now = new Date();
            for (let i = 11; i >= 0; i--) {
                const time = new Date(now);
                time.setMinutes(time.getMinutes() - (i * 5));
                labels.push(time.toLocaleTimeString('fa-IR', {
                    hour: '2-digit',
                    minute: '2-digit'
                }));
            }

            gasChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'دی‌اکسید کربن',
                        data: Array(12).fill().map(() => Math.floor(Math.random() * 1600 + 400)),
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#ef4444',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }, {
                        label: 'متان',
                        data: Array(12).fill().map(() => Math.floor(Math.random() * 1000)),
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#f59e0b',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }, {
                        label: 'اتان',
                        data: Array(12).fill().map(() => Math.floor(Math.random() * 500)),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#8b5cf6',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }, {
                        label: 'اکسیژن',
                        data: Array(12).fill().map(() => (Math.random() * 10 + 15).toFixed(1)),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#3b82f6',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }, {
                        label: 'هیدروژن',
                        data: Array(12).fill().map(() => Math.floor(Math.random() * 800)),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#10b981',
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true,
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    family: 'Vazirmatn'
                                }
                            }
                        },
                        tooltip: {
                            rtl: true,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y;
                                    if (context.dataset.label === 'اکسیژن') {
                                        label += '%';
                                    } else {
                                        label += ' ppm';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        // Update chart with new data
        function updateChart(data) {
            if (gasChart) {
                // Shift all labels left
                gasChart.data.labels.shift();

                // Add new time to the end
                const now = new Date();
                gasChart.data.labels.push(now.toLocaleTimeString('fa-IR', {
                    hour: '2-digit',
                    minute: '2-digit'
                }));

                // Update each dataset with new random data
                gasChart.data.datasets[0].data.shift();
                gasChart.data.datasets[0].data.push(data.co2);

                gasChart.data.datasets[1].data.shift();
                gasChart.data.datasets[1].data.push(data.ch4);

                gasChart.data.datasets[2].data.shift();
                gasChart.data.datasets[2].data.push(data.c2h6);

                gasChart.data.datasets[3].data.shift();
                gasChart.data.datasets[3].data.push(parseFloat(data.o2));

                gasChart.data.datasets[4].data.shift();
                gasChart.data.datasets[4].data.push(data.h2);

                gasChart.update();
            }
        }

        // Update data log
        function updateDataLog(data) {
            const now = new Date();
            const timestamp = now.toLocaleTimeString('fa-IR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }) + ' - ' +
                now.toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });

            database.addLog(timestamp, data.co2, data.ch4, data.c2h6, data.o2, data.h2);
        }

        // Show logged data in modal
        function showLoggedData() {
            const data = database.getLast100();
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';

            data.forEach(log => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-800';

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${log.timestamp}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${log.co2 > 1000 ? 'text-red-400' : 'text-gray-400'}">${log.co2}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${log.ch4 > 500 ? 'text-red-400' : 'text-gray-400'}">${log.ch4}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${log.c2h6 > 300 ? 'text-red-400' : 'text-gray-400'}">${log.c2h6}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${log.o2 < 19 ? 'text-red-400' : 'text-gray-400'}">${log.o2}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${log.h2 > 400 ? 'text-red-400' : 'text-gray-400'}">${log.h2}</td>
                `;

                tableBody.appendChild(row);
            });

            document.getElementById('data-modal').style.display = 'flex';
        }

        // Reset system
        function resetSystem() {
            database.clear();

            // Reset displays
            document.getElementById('co2-value').textContent = '0';
            document.querySelector('.circular-progress').style.background = 'conic-gradient(from 0.25turn, #1f2937 0%, #1f2937 100%)';

            document.getElementById('ch4-value').textContent = '0';
            document.getElementById('ch4-gauge').style.height = '0%';

            document.getElementById('c2h6-value').textContent = '0';
            document.getElementById('c2h6-bar').style.width = '0%';

            document.getElementById('o2-value').textContent = '0.0';
            document.getElementById('o2-needle').style.transform = 'rotate(0.25turn)';

            document.getElementById('h2-value').textContent = '0';
            const bubble = document.getElementById('h2-bubble');
            bubble.style.width = '80px';
            bubble.style.height = '80px';

            // Reset chart
            if (gasChart) {
                gasChart.data.labels = [];
                const now = new Date();
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now);
                    time.setMinutes(time.getMinutes() - (i * 5));
                    gasChart.data.labels.push(time.toLocaleTimeString('fa-IR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    }));
                }

                gasChart.data.datasets.forEach(dataset => {
                    dataset.data = Array(12).fill(0);
                });

                gasChart.update();
            }

            // Hide warning
            document.getElementById('warning-alert').classList.add('hidden');

            // Show confirmation
            alert('سیستم با موفقیت بازنشانی شد.');
        }

        // Toggle camera status
        function toggleCamera(cameraNum) {
            const camera = document.getElementById(`camera-${cameraNum}`);
            const cameraContainer = camera.closest('.bg-gray-900');
            const cameraStatusIndicator = cameraContainer.querySelector('.camera-status');
            const cameraToggleBtn = cameraContainer.querySelector('.camera-toggle');

            if (camera.classList.contains('camera-active')) {
                // غیرفعال کردن دوربین
                camera.classList.remove('camera-active');
                camera.classList.add('camera-inactive');
                // تغییر رنگ نشانگر به قرمز
                cameraStatusIndicator.classList.remove('bg-green-500');
                cameraStatusIndicator.classList.add('bg-red-500');
                // تغییر متن دکمه
                cameraToggleBtn.innerHTML = 'روشن کردن';
                cameraToggleBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                cameraToggleBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                // فعال کردن دوربین
                camera.classList.remove('camera-inactive');
                camera.classList.add('camera-active');
                // تغییر رنگ نشانگر به سبز
                cameraStatusIndicator.classList.remove('bg-red-500');
                cameraStatusIndicator.classList.add('bg-green-500');
                // تغییر متن دکمه
                cameraToggleBtn.innerHTML = 'خاموش کردن';
                cameraToggleBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                cameraToggleBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }
        }

        // Initialize everything
        function init() {
            initParticles();
            initChart();

            // Set up periodic updates
            setInterval(() => {
                updateDateTime();
                const data = generateRandomGasData();
                updateGasDisplays(data);
                updateChart(data);
                updateDataLog(data);
            }, 10000); // Update every 10 seconds

            // Initial update
            updateDateTime();
            const initialData = generateRandomGasData();
            updateGasDisplays(initialData);
            updateDataLog(initialData);

            // Event listeners
            document.getElementById('show-data-btn').addEventListener('click', showLoggedData);
            document.getElementById('reset-btn').addEventListener('click', resetSystem);
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('data-modal').style.display = 'none';
            });

            // Camera toggle buttons
            document.querySelectorAll('.camera-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const cameraNum = button.getAttribute('data-camera');
                    toggleCamera(cameraNum);
                });
            });
        }

        // Start the application
        window.onload = init;
    </script>
</body>

</html>
